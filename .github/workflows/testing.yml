name: Build and Deploy Testing

on:
  push:
    branches:
      - '*'
      - '!main'

env:
  DEPLOY_TO_DOMAIN: adamant-dev-testing.surge.sh

jobs:
  setup-build-publish-deploy:
    name: Setup, Build, Publish, and Deploy
    runs-on: ubuntu-latest
    environment: testing
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Setup Node version
        uses: actions/setup-node@v3
        with:
          node-version: '16'
      - name: Surge
        uses: afc163/surge-preview@v1
        id: preview_step
        with:
          surge_token: ${{ secrets.SURGE_TOKEN }}
          dist: dist
          build: |
            npm install
            npm run build
      - name: Get the `preview_url`
        run: echo "url => ${{ steps.preview_step.outputs.preview_url }}"